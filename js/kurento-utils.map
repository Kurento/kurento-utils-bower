{"version":3,"file":"bundle.js","sources":["../node_modules/grunt-browserify/node_modules/browserify/node_modules/browser-pack/_prelude.js","../node_modules/freeice/stun.json","../node_modules/freeice/turn.json","../lib/index.js","../lib/WebRtcPeer.js","../node_modules/freeice/index.js","../node_modules/freeice/node_modules/normalice/index.js"],"names":["WebRtcPeer","require","exports","defaultOnerror","error","console","noop","mode","localVideo","remoteVideo","onsdpoffer","onerror","videoStream","Object","defineProperty","this","writable","stream","freeice","prototype","start","self","pc","RTCPeerConnection","server","options","src","URL","createObjectURL","muted","addStream","constraints","mandatory","OfferToReceiveAudio","undefined","OfferToReceiveVideo","createOffer","offer","log","setLocalDescription","ended","onicecandidate","e","candidate","offerSdp","localDescription","sdp","dispose","signalingState","close","getAudioTracks","forEach","track","stop","getVideoTracks","userMediaConstraints","audio","video","maxWidth","maxFrameRate","minFrameRate","processSdpAnswer","sdpAnswer","answer","RTCSessionDescription","type","setRemoteDescription","getRemoteStreams","iceServers","optional","DtlsSrtpKeyAgreement","onSdp","mediaConstraints","wp","getUserMedia","userStream","startRecvOnly","onError","startSendOnly","startSendRecv","module","normalice","opts","getServers","count","idx","out","input","concat","servers","length","Math","random","splice","map","url","selected","stun","turn","stunCount","turnCount","protocols","protocol","parts","output","String","trim","indexOf","slice","split","username","credential","urls"],"mappings":"AAAA;AI6BA,QAASG,gBAAeC,GACnBA,GACHC,QAAQD,MAAMA,GAGhB,QAASE,SA2BT,QAASN,YAAWO,EAAMC,EAAYC,EAAaC,EAAYC,EAC7DC,GAEDC,OAAOC,eAAeC,KAAM,MAC3BC,UAAW,IAGZD,KAAKP,WAAaA,EAClBO,KAAKN,YAAcA,EACnBM,KAAKJ,QAAUA,GAAWR,eAC1BY,KAAKE,OAASL,EACdG,KAAKR,KAAOA,EACZQ,KAAKL,WAAaA,GAAcJ,KA1DjC,GAAIY,SAAUjB,QAAQ,UAuEtBD,YAAWmB,UAAUC,MAAQ,WAE5B,GAAIC,GAAON,IAENA,MAAKO,KACTP,KAAKO,GAAK,GAAIC,mBAAkBR,KAAKS,OAAQT,KAAKU,SAGnD,IAAIH,GAAKP,KAAKO,EAEVP,MAAKE,QAAUF,KAAKP,aACvBO,KAAKP,WAAWkB,IAAMC,IAAIC,gBAAgBb,KAAKE,QAC/CF,KAAKP,WAAWqB,OAAQ,GAGrBd,KAAKE,QACRK,EAAGQ,UAAUf,KAAKE,QAGnBF,KAAKgB,aACJC,WACCC,oBAA4CC,SAArBnB,KAAKN,YAC5B0B,oBAA4CD,SAArBnB,KAAKN,cAI9Ba,EAAGc,YAAY,SAASC,GACvBhC,QAAQiC,IAAI,qBACZhB,EAAGiB,oBAAoBF,EAAO,WAC7BhC,QAAQiC,IAAI,0BACVjB,EAAKV,UAENI,KAAKJ,QAASI,KAAKgB,YAErB,IAAIS,IAAQ,CACblB,GAAGmB,eAAiB,SAASC,GAE5B,GAAIA,EAAEC,UAGL,YADAH,GAAQ,EAIT,KAAGA,EAAH,CAEA,GAAII,GAAWtB,EAAGuB,iBAAiBC,GACnCzC,SAAQiC,IAAI,6BAEZjB,EAAKX,WAAWkC,EAAUvB,GAGxBmB,GAAQ,KAUZxC,WAAWmB,UAAU4B,QAAU,WAC9B1C,QAAQiC,IAAI,wBAORvB,KAAKO,IAAgC,UAA1BP,KAAKO,GAAG0B,gBACtBjC,KAAKO,GAAG2B,QAELlC,KAAKP,aACRO,KAAKP,WAAWkB,IAAM,IACnBX,KAAKN,cACRM,KAAKN,YAAYiB,IAAM,IAEpBX,KAAKE,SACRF,KAAKE,OAAOiC,iBAAiBC,QAAQ,SAASC,GAC7CA,EAAMC,MAAQD,EAAMC,SAErBtC,KAAKE,OAAOqC,iBAAiBH,QAAQ,SAASC,GAC7CA,EAAMC,MAAQD,EAAMC,WAavBrD,WAAWmB,UAAUoC,sBACpBC,OAAQ,EACRC,OACCzB,WACC0B,SAAW,IACXC,aAAe,GACfC,aAAe,MAgBlB5D,WAAWmB,UAAU0C,iBAAmB,SAASC,GAChD,GAAIC,GAAS,GAAIC,wBAChBC,KAAO,SACPnB,IAAMgB,GAGPzD,SAAQiC,IAAI,kDACZ,IAAIjB,GAAON,IACXM,GAAKC,GAAG4C,qBAAqBH,EAAQ,WACpC,GAAI1C,EAAKZ,YAAa,CACrB,GAAIQ,GAASI,EAAKC,GAAG6C,mBAAmB,EACxC9C,GAAKZ,YAAYiB,IAAMC,IAAIC,gBAAgBX,KAE1CF,KAAKJ,UASTX,WAAWmB,UAAUK,QACpB4C,WAAalD,WAUdlB,WAAWmB,UAAUM,SACpB4C,WACCC,sBAAuB,KA8BzBtE,WAAWoB,MAAQ,SAASb,EAAMC,EAAYC,EAAa8D,EAAO5D,EAChE6D,EAAkB5D,GACnB,GAAI6D,GAAK,GAAIzE,YAAWO,EAAMC,EAAYC,EAAa8D,EAAO5D,EAC5DC,EAEF,IAAgB,SAAZ6D,EAAGlE,MAAoBkE,EAAGxD,OAS7BwD,EAAGrD,YATkC,CACrC,GAAIW,GAAcyC,EAAmBA,EACjCC,EAAGlB,oBAEPmB,cAAa3C,EAAa,SAAS4C,GAClCF,EAAGxD,OAAS0D,EACZF,EAAGrD,SACDqD,EAAG9D,SAKP,MAAO8D,IAoBRzE,WAAW4E,cAAgB,SAASnE,EAAa8D,EAAOM,EACtDL,GACD,MAAOxE,YAAWoB,MAAM,OAAQ,KAAMX,EAAa8D,EAAOM,EACxDL,IAoBHxE,WAAW8E,cAAgB,SAAStE,EAAY+D,EAAOM,EACrDL,GACD,MAAOxE,YAAWoB,MAAM,OAAQZ,EAAY,KAAM+D,EAAOM,EACvDL,IAsBHxE,WAAW+E,cAAgB,SAASvE,EAAYC,EAAa8D,EAAOM,EAClEL,GACD,MAAOxE,YAAWoB,MAAM,WAAYZ,EAAYC,EAAa8D,EAC3DM,EAASL,IAGZQ,OAAO9E,QAAUF;;AD9UjB,GAAIA,YAAaC,QAAQ,eAEzBC,SAAQF,WAAaA;;AE1BrB,YAEA,IAAIiF,WAAYhF,QAAQ,aA4DpBiB,QAAU8D,OAAO9E,QAAU,SAASgF,GAWtC,QAASC,GAAWlB,EAAMmB,GAKxB,IAJA,GAEIC,GAFAC,KACAC,KAAWC,OAAOC,EAAQxB,IAGvBsB,EAAMG,QAAUJ,EAAII,OAASN,GAClCC,EAAOM,KAAKC,SAAWL,EAAMG,OAAU,EACvCJ,EAAMA,EAAIE,OAAOD,EAAMM,OAAOR,EAAK,GAGrC,OAAOC,GAAIQ,IAAI,SAASC,GACtB,MAAOd,WAAUhB,EAAO,IAAM8B,KApBlC,GAOIC,GAPAP,GACFQ,MAAOf,OAAYe,MAAQhG,QAAQ,eACnCiG,MAAOhB,OAAYgB,MAAQjG,QAAQ,gBAGjCkG,GAAajB,OAAYiB,WAAa,EACtCC,GAAalB,OAAYkB,WAAa,CAyB1C,OANAJ,MAAcR,OAAOL,EAAW,OAAQgB,IAEpCC,IACFJ,EAAWA,EAASR,OAAOL,EAAW,OAAQiB,KAGzCJ;;AClFT,GAAIK,YACF,QACA,QAGFrB,QAAO9E,QAAU,SAASqF,GACxB,GACIe,GACAC,EAFAR,GAAOR,OAAaQ,KAAOR,EAG3BiB,IAGJ,OAAkB,gBAAPT,IAAuBA,YAAeU,SAKjDV,EAAMA,EAAIW,QAGVJ,EAAWD,UAAUA,UAAUM,QAAQZ,EAAIa,MAAM,EAAG,OAMpDb,EAAMA,EAAIa,MAAM,GAChBL,EAAQR,EAAIc,MAAM,KAElBL,EAAOM,SAAWvB,EAAMuB,SACxBN,EAAOO,WAAaxB,EAAMwB,WAEtBR,EAAMb,OAAS,IACjBK,EAAMQ,EAAM,GACZA,EAAQA,EAAM,GAAGM,MAAM,KAGvBL,EAAOM,SAAWP,EAAM,GACxBC,EAAOO,YAAcxB,OAAawB,YAAcR,EAAM,IAAM,IAG9DC,EAAOT,IAAMO,EAAWP,EACxBS,EAAOQ,MAASR,EAAOT,KAEhBS,GAtBEjB,GATAA;;AL3BX;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AClBA;AACA","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","module.exports=[\n  \"stun.l.google.com:19302\",\n  \"stun1.l.google.com:19302\",\n  \"stun2.l.google.com:19302\",\n  \"stun3.l.google.com:19302\",\n  \"stun4.l.google.com:19302\",\n  \"stun.ekiga.net\",\n  \"stun.ideasip.com\",\n  \"stun.iptel.org\",\n  \"stun.rixtelecom.se\",\n  \"stun.schlund.de\",\n  \"stunserver.org\",\n  \"stun.stunprotocol.org:3478\",\n  \"stun.voiparound.com\",\n  \"stun.voipbuster.com\",\n  \"stun.voipstunt.com\",\n  \"stun.voxgratia.org\"\n]\n","module.exports=[]\n","/*\n * (C) Copyright 2014 Kurento (http://kurento.org/)\n *\n * All rights reserved. This program and the accompanying materials\n * are made available under the terms of the GNU Lesser General Public License\n * (LGPL) version 2.1 which accompanies this distribution, and is available at\n * http://www.gnu.org/licenses/lgpl-2.1.html\n *\n * This library is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n * Lesser General Public License for more details.\n *\n */\n\n/**\n * This module contains a set of reusable components that have been found useful\n * during the development of the WebRTC applications with Kurento.\n * \n * @module kurentoUtils\n * \n * @copyright 2014 Kurento (http://kurento.org/)\n * @license LGPL\n */\n\nvar WebRtcPeer = require('./WebRtcPeer');\n\nexports.WebRtcPeer = WebRtcPeer;\n","/*\n * (C) Copyright 2014 Kurento (http://kurento.org/)\n *\n * All rights reserved. This program and the accompanying materials\n * are made available under the terms of the GNU Lesser General Public License\n * (LGPL) version 2.1 which accompanies this distribution, and is available at\n * http://www.gnu.org/licenses/lgpl-2.1.html\n *\n * This library is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n * Lesser General Public License for more details.\n *\n */\n\nvar freeice = require('freeice');\n\n\n/**\n * @description Default handler for error callbacks. The error messaged passed\n *              as argument is showed in a console, a div layer which should be\n *              previously created.\n * \n * @function defaultOnerror\n * \n * @param error -\n *            {String} Error message\n * \n */\nfunction defaultOnerror(error) {\n\tif (error)\n\t\tconsole.error(error);\n}\n\nfunction noop() {\n};\n\n/**\n * \n * @classdesc Wrapper object of an RTCPeerConnection. This object is aimed to\n *            simplify the development of WebRTC-based applications.\n * \n * @constructor module:kurentoUtils.WebRtcPeer\n * \n * @param mode -\n *            {String} Mode in which the PeerConnection will be configured.\n *            Valid values are: 'recv', 'send', and 'sendRecv'\n * @param localVideo -\n *            {Object} Video tag for the local stream\n * @param remoteVideo -\n *            {Object} Video tag for the remote stream\n * @param onsdpoffer -\n *            {Function} Callback executed when a SDP offer has been generated\n * @param onerror -\n *            {Function} Callback executed when an error happens generating an\n *            SDP offer\n * @param videoStream -\n *            {Object} MediaStream to be used as source for localVideo and to be\n *            added as stream to the RTCPeerConnection\n * \n */\nfunction WebRtcPeer(mode, localVideo, remoteVideo, onsdpoffer, onerror,\n\t\tvideoStream) {\n\n\tObject.defineProperty(this, 'pc', {\n\t\twritable : true\n\t});\n\n\tthis.localVideo = localVideo;\n\tthis.remoteVideo = remoteVideo;\n\tthis.onerror = onerror || defaultOnerror;\n\tthis.stream = videoStream;\n\tthis.mode = mode;\n\tthis.onsdpoffer = onsdpoffer || noop;\n}\n\n/**\n * @description This method creates the RTCPeerConnection object taking into\n *              account the properties received in the constructor. It starts\n *              the SDP negotiation process: generates the SDP offer and invokes\n *              the onsdpoffer callback. This callback is expected to send the\n *              SDP offer, in order to obtain an SDP answer from another peer.\n * \n * @function module:kurentoUtils.WebRtcPeer.prototype.start\n * \n */\nWebRtcPeer.prototype.start = function() {\n\n\tvar self = this;\n\n\tif (!this.pc) {\n\t\tthis.pc = new RTCPeerConnection(this.server, this.options);\n\t}\n\n\tvar pc = this.pc;\n\n\tif (this.stream && this.localVideo) {\n\t\tthis.localVideo.src = URL.createObjectURL(this.stream);\n\t\tthis.localVideo.muted = true;\n\t}\n\n\tif (this.stream) {\n\t\tpc.addStream(this.stream);\n\t}\n\n\tthis.constraints = {\n\t\tmandatory : {\n\t\t\tOfferToReceiveAudio : (this.remoteVideo !== undefined),\n\t\t\tOfferToReceiveVideo : (this.remoteVideo !== undefined)\n\t\t}\n\t};\n\n\tpc.createOffer(function(offer) {\n\t\tconsole.log('Created SDP offer');\n\t\tpc.setLocalDescription(offer, function() {\n\t\t\tconsole.log('Local description set');\n\t\t}, self.onerror);\n\n\t}, this.onerror, this.constraints);\n\n  var ended = false;\n\tpc.onicecandidate = function(e) {\n\t\t// candidate exists in e.candidate\n\t\tif (e.candidate)\n\t\t{\n\t\t\tended = false;\n\t\t\treturn;\n\t\t}\n\n\t\tif(ended) return;\n\n\t\tvar offerSdp = pc.localDescription.sdp;\n\t\tconsole.log('ICE negotiation completed');\n\n\t\tself.onsdpoffer(offerSdp, self);\n\t\t// self.emit('sdpoffer', offerSdp);\n\n    ended = true;\n\t};\n}\n\n/**\n * @description This method frees the resources used by WebRtcPeer.\n * \n * @function module:kurentoUtils.WebRtcPeer.prototype.dispose\n * \n */\nWebRtcPeer.prototype.dispose = function() {\n\tconsole.log('Disposing WebRtcPeer');\n\n\t// FIXME This is not yet implemented in firefox\n\t// if (this.stream) this.pc.removeStream(this.stream);\n\n  // For old browsers, PeerConnection.close() is NOT idempotent and raise error\n  // We check its signaling state and don't close it if it's already closed\n\tif (this.pc && this.pc.signalingState != 'closed')\n\t\tthis.pc.close();\n\n\tif (this.localVideo)\n\t\tthis.localVideo.src = '';\n\tif (this.remoteVideo)\n\t\tthis.remoteVideo.src = '';\n\n\tif (this.stream) {\n\t\tthis.stream.getAudioTracks().forEach(function(track) {\n\t\t\ttrack.stop && track.stop()\n\t\t})\n\t\tthis.stream.getVideoTracks().forEach(function(track) {\n\t\t\ttrack.stop && track.stop()\n\t\t})\n\t}\n};\n\n/**\n * @description Default user media constraints considered when invoking the\n *              getUserMedia function. These values are: maxWidth=640,\n *              maxFrameRate=15, minFrameRate=15.\n * \n * @alias module:kurentoUtils.WebRtcPeer.prototype.userMediaConstraints\n * \n */\nWebRtcPeer.prototype.userMediaConstraints = {\n\taudio : true,\n\tvideo : {\n\t\tmandatory : {\n\t\t\tmaxWidth : 640,\n\t\t\tmaxFrameRate : 15,\n\t\t\tminFrameRate : 15\n\t\t}\n\t}\n};\n\n/**\n * @description Callback function invoked when and SDP answer is received.\n *              Developers are expected to invoke this function in order to\n *              complete the SDP negotiation.\n * \n * @function module:kurentoUtils.WebRtcPeer.prototype.processSdpAnswer\n * \n * @param sdpAnswer -\n *            Description of sdpAnswer\n * \n */\nWebRtcPeer.prototype.processSdpAnswer = function(sdpAnswer) {\n\tvar answer = new RTCSessionDescription({\n\t\ttype : 'answer',\n\t\tsdp : sdpAnswer,\n\t});\n\n\tconsole.log('SDP answer received, setting remote description');\n\tvar self = this;\n\tself.pc.setRemoteDescription(answer, function() {\n\t\tif (self.remoteVideo) {\n\t\t\tvar stream = self.pc.getRemoteStreams()[0];\n\t\t\tself.remoteVideo.src = URL.createObjectURL(stream);\n\t\t}\n\t}, this.onerror);\n}\n\n/**\n * @description Default ICE server (stun:stun.l.google.com:19302).\n * \n * @alias module:kurentoUtils.WebRtcPeer.prototype.server\n * \n */\nWebRtcPeer.prototype.server = {\n\ticeServers : freeice()\n};\n\n/**\n * @description Default options (DtlsSrtpKeyAgreement=true) for\n *              RTCPeerConnection.\n * \n * @alias module:kurentoUtils.WebRtcPeer.prototype.options\n * \n */\nWebRtcPeer.prototype.options = {\n\toptional : [ {\n\t\tDtlsSrtpKeyAgreement : true\n\t} ]\n};\n\n/**\n * @description This method creates the WebRtcPeer object and obtain userMedia\n *              if needed.\n * \n * @function module:kurentoUtils.WebRtcPeer.start\n * \n * @param mode -\n *            {String} Mode in which the PeerConnection will be configured.\n *            Valid values are: 'recv', 'send', and 'sendRecv'\n * @param localVideo -\n *            {Object} Video tag for the local stream\n * @param remoteVideo -\n *            {Object} Video tag for the remote stream\n * @param onSdp -\n *            {Function} Callback executed when a SDP offer has been generated\n * @param onerror -\n *            {Function} Callback executed when an error happens generating an\n *            SDP offer\n * @param mediaConstraints -\n *            {Object[]} Constraints used to create RTCPeerConnection\n * @param videoStream -\n *            {Object} MediaStream to be used as source for localVideo and to be\n *            added as stream to the RTCPeerConnection\n * \n * @return {module:kurentoUtils.WebRtcPeer}\n */\nWebRtcPeer.start = function(mode, localVideo, remoteVideo, onSdp, onerror,\n\t\tmediaConstraints, videoStream) {\n\tvar wp = new WebRtcPeer(mode, localVideo, remoteVideo, onSdp, onerror,\n\t\t\tvideoStream);\n\n\tif (wp.mode !== 'recv' && !wp.stream) {\n\t\tvar constraints = mediaConstraints ? mediaConstraints\n\t\t\t\t: wp.userMediaConstraints;\n\n\t\tgetUserMedia(constraints, function(userStream) {\n\t\t\twp.stream = userStream;\n\t\t\twp.start();\n\t\t}, wp.onerror);\n\t} else {\n\t\twp.start();\n\t}\n\n\treturn wp;\n};\n\n/**\n * @description This methods creates a WebRtcPeer to receive video.\n * \n * @function module:kurentoUtils.WebRtcPeer.startRecvOnly\n * \n * @param remoteVideo -\n *            {Object} Video tag for the remote stream\n * @param onSdp -\n *            {Function} Callback executed when a SDP offer has been generated\n * @param onerror -\n *            {Function} Callback executed when an error happens generating an\n *            SDP offer\n * @param mediaConstraints -\n *            {Object[]} Constraints used to create RTCPeerConnection\n * \n * @return {module:kurentoUtils.WebRtcPeer}\n */\nWebRtcPeer.startRecvOnly = function(remoteVideo, onSdp, onError,\n\t\tmediaConstraints) {\n\treturn WebRtcPeer.start('recv', null, remoteVideo, onSdp, onError,\n\t\t\tmediaConstraints);\n};\n\n/**\n * @description This methods creates a WebRtcPeer to send video.\n * \n * @function module:kurentoUtils.WebRtcPeer.startSendOnly\n * \n * @param localVideo -\n *            {Object} Video tag for the local stream\n * @param onSdp -\n *            {Function} Callback executed when a SDP offer has been generated\n * @param onerror -\n *            {Function} Callback executed when an error happens generating an\n *            SDP offer\n * @param mediaConstraints -\n *            {Object[]} Constraints used to create RTCPeerConnection\n * \n * @return {module:kurentoUtils.WebRtcPeer}\n */\nWebRtcPeer.startSendOnly = function(localVideo, onSdp, onError,\n\t\tmediaConstraints) {\n\treturn WebRtcPeer.start('send', localVideo, null, onSdp, onError,\n\t\t\tmediaConstraints);\n};\n\n/**\n * @description This methods creates a WebRtcPeer to send and receive video.\n * \n * @function module:kurentoUtils.WebRtcPeer.startSendRecv\n * \n * @param localVideo -\n *            {Object} Video tag for the local stream\n * @param remoteVideo -\n *            {Object} Video tag for the remote stream\n * @param onSdp -\n *            {Function} Callback executed when a SDP offer has been generated\n * @param onerror -\n *            {Function} Callback executed when an error happens generating an\n *            SDP offer\n * @param mediaConstraints -\n *            {Object[]} Constraints used to create RTCPeerConnection\n * \n * @return {module:kurentoUtils.WebRtcPeer}\n */\nWebRtcPeer.startSendRecv = function(localVideo, remoteVideo, onSdp, onError,\n\t\tmediaConstraints) {\n\treturn WebRtcPeer.start('sendRecv', localVideo, remoteVideo, onSdp,\n\t\t\tonError, mediaConstraints);\n};\n\nmodule.exports = WebRtcPeer;\n","/* jshint node: true */\n'use strict';\n\nvar normalice = require('normalice');\n\n/**\n  # freeice\n\n  The `freeice` module is a simple way of getting random STUN or TURN server\n  for your WebRTC application.  The list of servers (just STUN at this stage)\n  were sourced from this [gist](https://gist.github.com/zziuni/3741933).\n\n  ## Example Use\n\n  The following demonstrates how you can use `freeice` with\n  [rtc-quickconnect](https://github.com/rtc-io/rtc-quickconnect):\n\n  <<< examples/quickconnect.js\n\n  As the `freeice` module generates ice servers in a list compliant with the\n  WebRTC spec you will be able to use it with raw `RTCPeerConnection`\n  constructors and other WebRTC libraries.\n\n  ## Hey, don't use my STUN/TURN server!\n\n  If for some reason your free STUN or TURN server ends up in the\n  [list](servers.js) of servers that is used in this module, you can feel\n  free to open an issue on this repository and those servers will be removed\n  within 24 hours (or sooner).  This is the quickest and probably the most\n  polite way to have something removed (and provides us some visibility\n  if someone opens a pull request requesting that a server is added).\n\n  ## Please add my server!\n\n  If you have a server that you wish to add to the list, that's awesome! I'm\n  sure I speak on behalf of a whole pile of WebRTC developers who say thanks.\n  To get it into the list, feel free to either open a pull request or if you\n  find that process a bit daunting then just create an issue requesting\n  the addition of the server (make sure you provide all the details, and if\n  you have a Terms of Service then including that in the PR/issue would be\n  awesome).\n\n  ## I know of a free server, can I add it?\n\n  Sure, if you do your homework and make sure it is ok to use (I'm currently\n  in the process of reviewing the terms of those STUN servers included from\n  the original list).  If it's ok to go, then please see the previous entry\n  for how to add it.\n\n  ## Current List of Servers\n\n  * current as at the time of last `README.md` file generation\n\n  ### STUN\n\n  <<< stun.json\n\n  ### TURN\n\n  <<< turn.json\n\n**/\n\nvar freeice = module.exports = function(opts) {\n  // if a list of servers has been provided, then use it instead of defaults\n  var servers = {\n    stun: (opts || {}).stun || require('./stun.json'),\n    turn: (opts || {}).turn || require('./turn.json')\n  };\n\n  var stunCount = (opts || {}).stunCount || 2;\n  var turnCount = (opts || {}).turnCount || 0;\n  var selected;\n\n  function getServers(type, count) {\n    var out = [];\n    var input = [].concat(servers[type]);\n    var idx;\n\n    while (input.length && out.length < count) {\n      idx = (Math.random() * input.length) | 0;\n      out = out.concat(input.splice(idx, 1));\n    }\n\n    return out.map(function(url) {\n      return normalice(type + ':' + url);\n    });\n  }\n\n  // add stun servers\n  selected = [].concat(getServers('stun', stunCount));\n\n  if (turnCount) {\n    selected = selected.concat(getServers('turn', turnCount));\n  }\n\n  return selected;\n};\n","/**\n  # normalice\n\n  Normalize an ice server configuration object (or plain old string) into a format\n  that is usable in all browsers supporting WebRTC.  Primarily this module is designed\n  to help with the transition of the `url` attribute of the configuration object to\n  the `urls` attribute.\n\n  ## Example Usage\n\n  <<< examples/simple.js\n\n**/\n\nvar protocols = [\n  'stun:',\n  'turn:'\n];\n\nmodule.exports = function(input) {\n  var url = (input || {}).url || input;\n  var protocol;\n  var parts;\n  var output = {};\n\n  // if we don't have a string url, then allow the input to passthrough\n  if (typeof url != 'string' && (! (url instanceof String))) {\n    return input;\n  }\n\n  // trim the url string, and convert to an array\n  url = url.trim();\n\n  // if the protocol is not known, then passthrough\n  protocol = protocols[protocols.indexOf(url.slice(0, 5))];\n  if (! protocol) {\n    return input;\n  }\n\n  // now let's attack the remaining url parts\n  url = url.slice(5);\n  parts = url.split('@');\n\n  output.username = input.username;\n  output.credential = input.credential;\n  // if we have an authentication part, then set the credentials\n  if (parts.length > 1) {\n    url = parts[1];\n    parts = parts[0].split(':');\n\n    // add the output credential and username\n    output.username = parts[0];\n    output.credential = (input || {}).credential || parts[1] || '';\n  }\n\n  output.url = protocol + url;\n  output.urls = [ output.url ];\n\n  return output;\n};\n"]}